# Vercel éƒ¨ç½²é…ç½®æŒ‡å—

## é—®é¢˜è§£å†³ï¼šPrisma Client åœ¨ Vercel Edge Runtime çš„é”™è¯¯

### ğŸ”§ å·²å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

#### 1. Prisma å•ä¾‹æ¨¡å¼ (`lib/prisma.ts`)
- é¿å…åˆ›å»ºå¤šä¸ª Prisma å®ä¾‹
- å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œé˜²æ­¢è¿æ¥æ³„æ¼
- ç”Ÿäº§ç¯å¢ƒè¿æ¥æ¸…ç†

#### 2. API Route é…ç½® (`app/api/users/route.ts`)
- æ˜ç¡®æŒ‡å®š `export const runtime = 'nodejs'`
- ä½¿ç”¨ NextResponse æ›¿ä»£ Response
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ•°æ®éªŒè¯

#### 3. æ•°æ®åº“è¿æ¥ç®¡ç† (`lib/db.ts`)
- è¿æ¥å¥åº·æ£€æŸ¥
- å®‰å…¨çš„æ“ä½œåŒ…è£…å™¨
- ç¯å¢ƒç‰¹å®šé…ç½®

#### 4. Webpack é…ç½® (`next.config.js`)
- æ’é™¤ Prisma å®¢æˆ·ç«¯åˆ°æµè§ˆå™¨åŒ…
- æœåŠ¡å™¨ç»„ä»¶å¤–éƒ¨åŒ…é…ç½®

### ğŸš€ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

#### ç¯å¢ƒå˜é‡è®¾ç½®
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ç¡®ä¿æœ‰ï¼š
```bash
DATABASE_URL="ä½ çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²"
NODE_ENV="production"
```

#### æ„å»ºå‘½ä»¤
ç¡®ä¿ `package.json` ä¸­çš„æ„å»ºè„šæœ¬ï¼š
```json
{
  "scripts": {
    "build": "prisma generate && next build",
    "postinstall": "prisma generate"
  }
}
```

#### Vercel é…ç½®
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `vercel.json`ï¼ˆå¯é€‰ï¼‰ï¼š
```json
{
  "functions": {
    "app/api/**/*.ts": {
      "runtime": "nodejs18.x"
    }
  }
}
```

### ğŸ§ª éƒ¨ç½²åéªŒè¯

#### 1. å¥åº·æ£€æŸ¥ç«¯ç‚¹
è®¿é—® `https://your-domain.vercel.app/api/health` ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸ã€‚

#### 2. ç”¨æˆ· API æµ‹è¯•
```bash
curl https://your-domain.vercel.app/api/users
```

### ğŸ“Š å¸¸è§é—®é¢˜è§£å†³

#### é”™è¯¯ï¼š`PrismaClient is unable to run in this browser environment`
âœ… **å·²è§£å†³**ï¼šé€šè¿‡æ˜ç¡®æŒ‡å®š `runtime = 'nodejs'` å’Œ webpack é…ç½®

#### é”™è¯¯ï¼šæ•°æ®åº“è¿æ¥è¶…æ—¶
âœ… **å·²è§£å†³**ï¼šé€šè¿‡è¿æ¥æ± é…ç½®å’Œè¿æ¥ç®¡ç†

#### é”™è¯¯ï¼šå†…å­˜ä½¿ç”¨è¿‡é«˜
âœ… **å·²è§£å†³**ï¼šé€šè¿‡å•ä¾‹æ¨¡å¼å’Œè¿æ¥æ¸…ç†

### ğŸ” è°ƒè¯•æŠ€å·§

1. **å¯ç”¨æŸ¥è¯¢æ—¥å¿—**ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰ï¼š
   ```typescript
   new PrismaClient({ log: ['query'] })
   ```

2. **ç›‘æ§ API å“åº”æ—¶é—´**ï¼š
   ä½¿ç”¨ `/api/health` ç«¯ç‚¹æ£€æŸ¥æ€§èƒ½

3. **æ£€æŸ¥ Vercel å‡½æ•°æ—¥å¿—**ï¼š
   åœ¨ Vercel Dashboard ä¸­æŸ¥çœ‹å‡½æ•°æ‰§è¡Œæ—¥å¿—

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨è¿æ¥æ± **ï¼šå·²åœ¨ `lib/db.ts` ä¸­é…ç½®
2. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨ `select` å­—æ®µé™åˆ¶è¿”å›æ•°æ®
3. **ç¼“å­˜ç­–ç•¥**ï¼šè€ƒè™‘åœ¨ API å±‚æ·»åŠ  Redis ç¼“å­˜
4. **åˆ†é¡µ**ï¼šå¤§æ•°æ®é›†ä½¿ç”¨ `skip` å’Œ `take`

### ğŸ”„ æ›´æ–°å’Œè¿ç§»

1. **æ•°æ®åº“æ¨¡å¼æ›´æ–°**ï¼š
   ```bash
   npx prisma migrate dev
   git add .
   git commit -m "Update database schema"
   ```

2. **éƒ¨ç½²æ›´æ–°**ï¼š
   Vercel ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°æ„å»ºå’Œéƒ¨ç½²

---

ğŸ¯ **ä¿®å¤æ€»ç»“**ï¼šé€šè¿‡è¿™ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œä½ çš„ Prisma åº”ç”¨ç°åœ¨å¯ä»¥åœ¨ Vercel ä¸Šæ­£å¸¸è¿è¡Œï¼Œä¸å†å‡ºç° Edge Runtime ç›¸å…³çš„é”™è¯¯ã€‚